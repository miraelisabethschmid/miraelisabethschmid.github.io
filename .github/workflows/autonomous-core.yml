name: Autonomous Core

on:
  workflow_dispatch:

jobs:
  autonomous-core:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set paths
        env:
          REGISTRY: .system/registry.json
        run: |
          echo "REGISTRY=${REGISTRY}" >> $GITHUB_ENV

      - name: Ensure system directories exist
        run: |
          mkdir -p .system/modules
          mkdir -p .system/data

      - name: Ensure registry exists
        run: |
          if [ ! -f "$REGISTRY" ]; then
            echo '{"workflows": [], "modules": []}' > "$REGISTRY"
            echo "Created empty registry.json"
          else
            echo "Registry exists."
          fi

      - name: Sync workflows from registry
        run: |
          python3 .system/sync.py
